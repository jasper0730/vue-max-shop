import{c as I}from"./format-DIAi3n-z.js";import{P as T,M as j}from"./modal-CfQt8UhM.js";import{L as D}from"./index-BHRmrraG.js";import{e as B,q as N,T as L,k as S,f as r,C as U,g as e,U as F,v as z,m as n,_ as q,r as y,w as G,i as w,G as H,t as $,y as p,D as b,s as R,F as V,l as A,S as J,a as K,j as M,A as Q,I as P}from"./index-ioYnAnfa.js";import{_ as W}from"./DeleteModal.vue_vue_type_script_setup_true_lang-DEAFqiqi.js";const X={key:0,class:"custom-modal"},Y=B({__name:"Modal",props:{show:Boolean},setup(g){return(m,c)=>(n(),N(L,{name:"fade"},{default:S(()=>[g.show?(n(),r("div",X,[e("div",{class:"overlay",onClick:c[0]||(c[0]=z(_=>m.$emit("close"),["self"]))}),F(m.$slots,"default",{},void 0,!0)])):U("",!0)]),_:3}))}}),Z=q(Y,[["__scopeId","data-v-01ecdb53"]]),ee={class:"container bg-light z-1 p-0"},te={class:"content pb-5"},se={class:"header d-flex bg-dark text-light p-3 mb-3 justify-content-between"},le={class:"title fs-5"},oe={class:"body px-3 py-2"},ae={class:"row"},ne={class:"col-md-6"},ie={class:"mb-3"},de={class:"mb-3"},re={for:"customFile",class:"form-label"},ce={key:0,class:"fas fa-spinner fa-spin"},ue={type:"file",id:"customFile",class:"form-control",ref:"fileInput"},pe=["src"],me={key:0,class:"mt-3"},ve=["onUpdate:modelValue"],fe=["src"],be=["onClick"],_e={class:"col-md-6"},ye={class:"mb-3"},xe={class:"row gx-2"},ge={class:"mb-3 col-md-6"},he={class:"mb-3 col-md-6"},we={class:"row gx-2"},$e={class:"mb-3 col-md-6"},ke={class:"mb-3 col-md-6"},Ue={class:"mb-3"},Ce={class:"mb-3"},Me={class:"mb-3"},Pe={class:"form-check"},Ve={class:"footer d-flex justify-content-end mt-3 gap-2 px-3"},Be=B({__name:"AdminProductModal",props:{isModalOpen:{type:Boolean,default:!1},tempProduct:{type:Object,default:()=>({title:"",category:"",origin_price:0,price:0,is_enabled:!1})},isNew:{type:Boolean,default:!1}},emits:["close","save"],setup(g,{emit:m}){const c=g,_=m,s=y({...c.tempProduct}),u=y(!1);G(()=>c.tempProduct,i=>{s.value={...i}},{deep:!0});const h=()=>{_("save",s.value)};return(i,t)=>(n(),N(H,{to:"body"},[w(Z,{show:g.isModalOpen,onClose:t[12]||(t[12]=v=>_("close"))},{default:S(()=>{var v,x;return[e("div",ee,[e("div",te,[e("div",se,[e("div",le,$(g.isNew?"新增產品":"編輯產品"),1),e("button",{type:"button",class:"btn-close btn-close-white focus-ring",onClick:t[0]||(t[0]=l=>_("close"))})]),e("div",oe,[e("div",ae,[e("div",ne,[e("div",ie,[t[13]||(t[13]=e("label",{for:"image",class:"form-label"},"輸入圖片網址",-1)),p(e("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":t[1]||(t[1]=l=>s.value.imageUrl=l),placeholder:"請輸入圖片連結"},null,512),[[b,s.value.imageUrl]])]),e("div",de,[e("label",re,[t[14]||(t[14]=R(" 或 上傳圖片 ")),u.value?(n(),r("i",ce)):U("",!0)]),e("input",ue,null,512)]),e("img",{class:"img-fluid",src:s.value.imageUrl},null,8,pe),(v=s.value.imagesUrl)!=null&&v.length?(n(),r("div",me,[(n(!0),r(V,null,A(s.value.imagesUrl,(l,f)=>(n(),r("div",{key:f,class:"mb-3"},[p(e("input",{type:"url",class:"form-control","onUpdate:modelValue":k=>s.value.imagesUrl[f]=k,placeholder:"請輸入圖片連結"},null,8,ve),[[b,s.value.imagesUrl[f]]]),e("img",{class:"img-fluid mt-2",src:l},null,8,fe),e("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100 mt-2",onClick:k=>s.value.imagesUrl.splice(f,1)}," 刪除圖片 ",8,be)]))),128))])):U("",!0),!((x=s.value.imagesUrl)!=null&&x.length)||s.value.imagesUrl[s.value.imagesUrl.length-1]?(n(),r("button",{key:1,class:"btn btn-outline-dark btn-sm d-block w-100 mt-2",onClick:t[2]||(t[2]=l=>{var f;return(f=s.value.imagesUrl)==null?void 0:f.push("")})}," 新增圖片 ")):U("",!0)]),e("div",_e,[e("div",ye,[t[15]||(t[15]=e("label",{for:"title",class:"form-label"},"標題",-1)),p(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.title=l),placeholder:"請輸入標題"},null,512),[[b,s.value.title]])]),e("div",xe,[e("div",ge,[t[16]||(t[16]=e("label",{for:"category",class:"form-label"},"分類",-1)),p(e("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":t[4]||(t[4]=l=>s.value.category=l),placeholder:"請輸入分類"},null,512),[[b,s.value.category]])]),e("div",he,[t[17]||(t[17]=e("label",{for:"unit",class:"form-label"},"單位",-1)),p(e("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":t[5]||(t[5]=l=>s.value.unit=l),placeholder:"請輸入單位"},null,512),[[b,s.value.unit]])])]),e("div",we,[e("div",$e,[t[18]||(t[18]=e("label",{for:"origin_price",class:"form-label"},"原價",-1)),p(e("input",{type:"number",class:"form-control",id:"origin_price",min:"0","onUpdate:modelValue":t[6]||(t[6]=l=>s.value.origin_price=l),placeholder:"請輸入原價"},null,512),[[b,s.value.origin_price,void 0,{number:!0}]])]),e("div",ke,[t[19]||(t[19]=e("label",{for:"price",class:"form-label"},"售價",-1)),p(e("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":t[7]||(t[7]=l=>s.value.price=l),min:"0",placeholder:"請輸入售價"},null,512),[[b,s.value.price,void 0,{number:!0}]])])]),e("div",Ue,[t[20]||(t[20]=e("label",{for:"description",class:"form-label"},"產品描述",-1)),p(e("textarea",{class:"form-control",id:"description","onUpdate:modelValue":t[8]||(t[8]=l=>s.value.description=l),placeholder:"請輸入產品描述"},null,512),[[b,s.value.description]])]),e("div",Ce,[t[21]||(t[21]=e("label",{for:"content",class:"form-label"},"說明內容",-1)),p(e("textarea",{class:"form-control",id:"content","onUpdate:modelValue":t[9]||(t[9]=l=>s.value.content=l),placeholder:"請輸入產品說明內容"},null,512),[[b,s.value.content]])]),e("div",Me,[e("div",Pe,[p(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=l=>s.value.is_enabled=l),id:"is_enabled"},null,512),[[J,s.value.is_enabled]]),t[22]||(t[22]=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1))])])])])]),e("div",Ve,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[11]||(t[11]=l=>_("close"))},"取消"),e("button",{type:"button",class:"btn btn-primary",onClick:h},"儲存")])])])]}),_:1},8,["show"])]))}}),Ie={class:"pb-5"},Ne={class:"text-end mt-3"},Se={class:"mt-4 overflow-auto"},Ae={class:"product-table",style:{"min-width":"700px"}},Ee={class:"tbody pt-2"},Oe={class:"td px-1 py-2",style:{flex:"1","min-width":"100px"}},Te={class:"td px-1 py-2",style:{flex:"2","min-width":"200px"}},je={class:"td px-1 py-2",style:{flex:"1","min-width":"100px"}},De={class:"td px-1 py-2",style:{flex:"1","min-width":"100px"}},Le={key:0,class:"td px-1 py-2 text-success",style:{flex:"1","min-width":"100px"}},Fe={key:1,class:"td px-1 py-2 text-danger",style:{flex:"1","min-width":"100px"}},ze={style:{flex:"1","min-width":"100px"}},qe=["onClick"],Ge=["onClick"],We=B({__name:"AdminProducts",setup(g){const m="https://vue3-course-api.hexschool.io/v2",c="jasper07301",_=y([]),s=y({}),u=y(!1),h=y(!1),i=y({title:"",category:"",origin_price:0,price:0,is_enabled:!1}),t=y(null);let v=null;const x=async(d=1)=>{try{u.value=!0;const o=`${m}/api/${c}/admin/products?page=${d}`,a=await P.get(o);if(a.data.success)_.value=a.data.products,s.value=a.data.pagination;else throw new Error(a.data.message||"獲取資料失敗")}catch(o){console.error("獲取資料失敗",o)}finally{u.value=!1}},l=(d,o)=>{!d&&o?i.value={...o}:i.value={title:"",category:"",origin_price:0,price:0,is_enabled:!1},h.value=!0},f=()=>{h.value=!1},k=async()=>{try{u.value=!0;const d=`${m}/api/${c}/admin/product/${i.value.id}`,o=await P.delete(d);if(o.data.success)x();else throw new Error(o.data.message||"刪除失敗")}catch(d){console.error("刪除產品失敗",d)}finally{u.value=!1}v==null||v.hide()},E=d=>{i.value={...d},t.value&&(v=new j(t.value.$el),v.show())},O=async d=>{try{u.value=!0;const o=i.value.id?`${m}/api/${c}/admin/product/${i.value.id}`:`${m}/api/${c}/admin/product`,a=i.value.id?"put":"post",C=await P[a](o,{data:d});if(C.data.success)x(),h.value=!1;else throw new Error(C.data.message||"儲存失敗")}catch(o){console.error("儲存產品失敗",o)}finally{u.value=!1}};return K(()=>{x()}),(d,o)=>(n(),r(V,null,[w(M(D),{active:u.value||u.value,"z-index":1060},null,8,["active"]),e("div",Ie,[e("div",Ne,[e("button",{type:"button",class:"btn btn-dark rounded",onClick:o[0]||(o[0]=()=>l(!0))}," 建立新的產品 ")]),e("div",Se,[e("div",Ae,[o[1]||(o[1]=Q('<div class="thead fw-bold pb-2 border-bottom border-3 border-dark"><div class="tr d-flex"><div class="th px-1 py-2" style="flex:1;min-width:100px;">分類</div><div class="th px-1 py-2" style="flex:2;min-width:200px;">產品名稱</div><div class="th px-1 py-2" style="flex:1;min-width:100px;">原價</div><div class="th px-1 py-2" style="flex:1;min-width:100px;">售價</div><div class="th px-1 py-2" style="flex:1;min-width:100px;">是否啟用</div><div class="th px-1 py-2" style="flex:1;min-width:100px;">編輯</div></div></div>',1)),e("div",Ee,[(n(!0),r(V,null,A(_.value,a=>(n(),r("div",{class:"tr d-flex border-bottom",key:a.id},[e("div",Oe,$(a.category),1),e("div",Te,$(a.title),1),e("div",je,$(M(I)(a.origin_price)),1),e("div",De,$(M(I)(a.price)),1),a.is_enabled?(n(),r("div",Le," 啟用 ")):(n(),r("div",Fe," 未啟用 ")),e("div",ze,[e("button",{type:"button",class:"btn btn-outline-dark rounded btn-sm",onClick:C=>l(!1,a)}," 編輯 ",8,qe),e("button",{type:"button",class:"btn btn-outline-dark rounded btn-sm ms-1",onClick:()=>E(a)}," 刪除 ",8,Ge)])]))),128))])])]),w(T,{onUpdatePage:x,pages:s.value},null,8,["pages"])]),w(W,{ref_key:"deleteModalElement",ref:t,onDeleteItem:k,title:i.value.title},null,8,["title"]),w(Be,{isModalOpen:h.value,tempProduct:i.value,onClose:f,onSave:O},null,8,["isModalOpen","tempProduct"])],64))}});export{We as default};
