import{d as N}from"./format-DIAi3n-z.js";import{e as U,r,w as P,a as L,f as y,g as e,t as k,y as w,D as C,S as A,m as h,i as x,j as D,F as B,l as S,I as M}from"./index-ioYnAnfa.js";import{L as T}from"./index-BHRmrraG.js";import{M as V,P as j}from"./modal-CfQt8UhM.js";import{_ as F}from"./DeleteModal.vue_vue_type_script_setup_true_lang-DEAFqiqi.js";const z={class:"modal-dialog"},H={class:"modal-content border-0"},O={class:"modal-header bg-dark text-white"},R={class:"modal-title",id:"couponModalLabel"},q={class:"modal-body"},G={class:"mb-3"},J={class:"mb-3"},K={class:"mb-3"},Q={class:"mb-3"},W={class:"form-check"},X={class:"modal-footer"},Y=U({__name:"AdminCouponModal",props:{isNew:{type:Boolean},coupon:{}},emits:["update-coupon"],setup(E,{expose:v,emit:b}){const i=E,g=b,f=r(null),l=r({...i.coupon}),c=r(new Date(l.value.due_date).toISOString().split("T")[0]);let d=null;P(()=>i.coupon,_=>{l.value={..._}},{deep:!0,immediate:!0});const u=()=>{l.value.due_date=new Date(c.value).getTime(),g("update-coupon",l.value),m()},p=()=>{d==null||d.show()},m=()=>{d==null||d.hide()};return L(()=>{f.value&&(d=new V(f.value))}),v({showModal:p,hideModal:m}),(_,t)=>(h(),y("div",{class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel",ref_key:"modalElement",ref:f},[e("div",z,[e("div",H,[e("div",O,[e("h5",R,k(_.isNew?"新增優惠券":"編輯優惠券"),1),t[5]||(t[5]=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",q,[e("div",G,[t[6]||(t[6]=e("label",{for:"title"},"標題",-1)),w(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=a=>l.value.title=a),placeholder:"請輸入標題"},null,512),[[C,l.value.title]])]),e("div",J,[t[7]||(t[7]=e("label",{for:"coupon_code"},"優惠碼",-1)),w(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=a=>l.value.code=a),placeholder:"請輸入優惠碼"},null,512),[[C,l.value.code]])]),e("div",K,[t[8]||(t[8]=e("label",{for:"due_date"},"到期日",-1)),w(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=a=>c.value=a)},null,512),[[C,c.value]])]),e("div",Q,[t[9]||(t[9]=e("label",{for:"percent"},"折扣百分比",-1)),w(e("input",{type:"number",class:"form-control",id:"percent",min:"0",max:"100","onUpdate:modelValue":t[3]||(t[3]=a=>l.value.percent=a),placeholder:"請輸入折扣百分比"},null,512),[[C,l.value.percent,void 0,{number:!0}]])]),e("div",W,[w(e("input",{class:"form-check-input",type:"checkbox",id:"is_enabled","onUpdate:modelValue":t[4]||(t[4]=a=>l.value.is_enabled=a),"true-value":1,"false-value":0},null,512),[[A,l.value.is_enabled]]),t[10]||(t[10]=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1))])]),e("div",X,[t[11]||(t[11]=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1)),e("button",{type:"button",class:"btn btn-dark",onClick:u},k(_.isNew?"新增優惠券":"更新優惠券"),1)])])])],512))}}),Z={class:"text-end mt-3"},ee={class:"d-flex justify-content-center"},te={class:"table mt-4"},oe={key:0,class:"text-success"},le={key:1,class:"text-muted"},ne=["onClick"],se=["onClick"],ce=U({__name:"AdminCoupons",setup(E){const v="https://vue3-course-api.hexschool.io/v2",b="jasper07301",i=r(!1),g=r(!1),f=r([]),l=r({}),c=r(null),d=r(null),u=r({code:"",due_date:0,id:"string",is_enabled:0,num:0,percent:0,title:""});let p=null;const m=async(n=1)=>{try{i.value=!0;const o=`${v}/api/${b}/admin/coupons?page=${n}`,s=await M.get(o);if(s.data.success)f.value=s.data.coupons,l.value=s.data.pagination;else throw new Error(s.data.message||"獲取資料失敗")}catch(o){console.error("獲取資料失敗",o)}finally{i.value=!1}},_=async n=>{try{i.value=!0;const o=u.value.id?`${v}/api/${b}/admin/coupon/${u.value.id}`:`${v}/api/${b}/admin/coupon`,s=u.value.id?"put":"post",$=await M[s](o,{data:n});if($.data.success)m();else throw new Error($.data.message||"儲存優惠券失敗")}catch(o){console.error("儲存優惠券失敗",o)}finally{i.value=!1}},t=n=>{u.value={...n},c.value&&(p=new V(c.value.$el),p.show())},a=(n,o)=>{g.value=n,!n&&o?u.value={...o}:u.value={code:"",due_date:0,id:"",is_enabled:0,num:0,percent:0,title:""},d.value&&d.value.showModal()},I=async()=>{try{i.value=!0;const n=`${v}/api/${b}/admin/coupon/${u.value.id}`,o=await M.delete(n);if(o.data.success)m();else throw new Error(o.data.message||"優惠券刪除失敗")}catch(n){console.error("優惠券刪除失敗",n)}finally{i.value=!1}p==null||p.hide()};return L(()=>{m()}),(n,o)=>(h(),y("div",null,[x(D(T),{active:i.value,"z-index":1060},null,8,["active"]),e("div",Z,[e("button",{class:"btn btn-dark rounded",type:"button",onClick:o[0]||(o[0]=()=>a(!0))}," 建立新的優惠券 ")]),e("div",ee,[e("table",te,[o[1]||(o[1]=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1)),e("tbody",null,[(h(!0),y(B,null,S(f.value,(s,$)=>(h(),y("tr",{key:$},[e("td",null,k(s.title),1),e("td",null,k(s.percent)+"%",1),e("td",null,k(D(N)(s.due_date)),1),e("td",null,[s.is_enabled===1?(h(),y("span",oe,"啟用")):(h(),y("span",le,"未啟用"))]),e("td",null,[e("button",{class:"btn btn-outline-dark rounded btn-sm ms-1",onClick:()=>a(!1,s)}," 編輯 ",8,ne),e("button",{class:"btn btn-outline-dark rounded btn-sm ms-1",onClick:()=>t(s)}," 刪除 ",8,se)])]))),128))])])]),x(Y,{ref_key:"couponModalElement",ref:d,isNew:g.value,coupon:u.value,onUpdateCoupon:_},null,8,["isNew","coupon"]),x(F,{ref_key:"deleteModalElement",ref:c,onDeleteItem:I,title:u.value.title},null,8,["title"]),x(j,{pages:l.value,onUpdatePage:m},null,8,["pages"])]))}});export{ce as default};
