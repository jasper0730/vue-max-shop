import{c as E}from"./format-DIAi3n-z.js";import{P as j,M as A}from"./modal-h-oxxpaG.js";import{L}from"./index-3zDf_1eA.js";import{d as B,a as N,T as D,w as I,i as r,B as U,b as e,Q as F,k as z,h as i,_ as H,r as y,m as Q,e as w,E as R,t as $,y as p,C as b,f as q,F as V,x as O,P as G,o as J,u as M,j as K}from"./index-n62W8uT2.js";/* empty css                                                              */import{_ as W}from"./DeleteModal.vue_vue_type_script_setup_true_lang-Bb9TtG59.js";import{a as P}from"./index-DW_MHI2K.js";import"./_commonjsHelpers-C932wzq6.js";import"./selector-engine-C4SBvMeJ.js";const X={key:0,class:"custom-modal"},Y=B({__name:"Modal",props:{show:Boolean},setup(g){return(m,c)=>(i(),N(D,{name:"fade"},{default:I(()=>[g.show?(i(),r("div",X,[e("div",{class:"overlay",onClick:c[0]||(c[0]=z(_=>m.$emit("close"),["self"]))}),F(m.$slots,"default",{},void 0,!0)])):U("",!0)]),_:3}))}}),Z=H(Y,[["__scopeId","data-v-01ecdb53"]]),ee={class:"container bg-light z-1 p-0"},te={class:"content pb-5"},se={class:"header d-flex bg-dark text-light p-3 mb-3 justify-content-between"},le={class:"title fs-5"},oe={class:"body px-3 py-2"},ae={class:"row"},ie={class:"col-md-6"},ne={class:"mb-3"},de={class:"mb-3"},re={for:"customFile",class:"form-label"},ce={key:0,class:"fas fa-spinner fa-spin"},ue={type:"file",id:"customFile",class:"form-control",ref:"fileInput"},pe=["src"],me={key:0,class:"mt-3"},ve=["onUpdate:modelValue"],fe=["src"],be=["onClick"],_e={class:"col-md-6"},ye={class:"mb-3"},xe={class:"row gx-2"},ge={class:"mb-3 col-md-6"},he={class:"mb-3 col-md-6"},we={class:"row gx-2"},$e={class:"mb-3 col-md-6"},ke={class:"mb-3 col-md-6"},Ue={class:"mb-3"},Ce={class:"mb-3"},Me={class:"mb-3"},Pe={class:"form-check"},Ve={class:"footer d-flex justify-content-end mt-3 gap-2 px-3"},Be=B({__name:"AdminProductModal",props:{isModalOpen:{type:Boolean,default:!1},tempProduct:{type:Object,default:()=>({title:"",category:"",origin_price:0,price:0,is_enabled:!1})},isNew:{type:Boolean,default:!1}},emits:["close","save"],setup(g,{emit:m}){const c=g,_=m,s=y({...c.tempProduct}),u=y(!1);Q(()=>c.tempProduct,n=>{s.value={...n}},{deep:!0});const h=()=>{_("save",s.value)};return(n,t)=>(i(),N(R,{to:"body"},[w(Z,{show:g.isModalOpen,onClose:t[12]||(t[12]=v=>_("close"))},{default:I(()=>{var v,x;return[e("div",ee,[e("div",te,[e("div",se,[e("div",le,$(g.isNew?"新增產品":"編輯產品"),1),e("button",{type:"button",class:"btn-close btn-close-white focus-ring",onClick:t[0]||(t[0]=l=>_("close"))})]),e("div",oe,[e("div",ae,[e("div",ie,[e("div",ne,[t[13]||(t[13]=e("label",{for:"image",class:"form-label"},"輸入圖片網址",-1)),p(e("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":t[1]||(t[1]=l=>s.value.imageUrl=l),placeholder:"請輸入圖片連結"},null,512),[[b,s.value.imageUrl]])]),e("div",de,[e("label",re,[t[14]||(t[14]=q(" 或 上傳圖片 ")),u.value?(i(),r("i",ce)):U("",!0)]),e("input",ue,null,512)]),e("img",{class:"img-fluid",src:s.value.imageUrl},null,8,pe),(v=s.value.imagesUrl)!=null&&v.length?(i(),r("div",me,[(i(!0),r(V,null,O(s.value.imagesUrl,(l,f)=>(i(),r("div",{key:f,class:"mb-3"},[p(e("input",{type:"url",class:"form-control","onUpdate:modelValue":k=>s.value.imagesUrl[f]=k,placeholder:"請輸入圖片連結"},null,8,ve),[[b,s.value.imagesUrl[f]]]),e("img",{class:"img-fluid mt-2",src:l},null,8,fe),e("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100 mt-2",onClick:k=>s.value.imagesUrl.splice(f,1)}," 刪除圖片 ",8,be)]))),128))])):U("",!0),!((x=s.value.imagesUrl)!=null&&x.length)||s.value.imagesUrl[s.value.imagesUrl.length-1]?(i(),r("button",{key:1,class:"btn btn-outline-dark btn-sm d-block w-100 mt-2",onClick:t[2]||(t[2]=l=>{var f;return(f=s.value.imagesUrl)==null?void 0:f.push("")})}," 新增圖片 ")):U("",!0)]),e("div",_e,[e("div",ye,[t[15]||(t[15]=e("label",{for:"title",class:"form-label"},"標題",-1)),p(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.title=l),placeholder:"請輸入標題"},null,512),[[b,s.value.title]])]),e("div",xe,[e("div",ge,[t[16]||(t[16]=e("label",{for:"category",class:"form-label"},"分類",-1)),p(e("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":t[4]||(t[4]=l=>s.value.category=l),placeholder:"請輸入分類"},null,512),[[b,s.value.category]])]),e("div",he,[t[17]||(t[17]=e("label",{for:"unit",class:"form-label"},"單位",-1)),p(e("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":t[5]||(t[5]=l=>s.value.unit=l),placeholder:"請輸入單位"},null,512),[[b,s.value.unit]])])]),e("div",we,[e("div",$e,[t[18]||(t[18]=e("label",{for:"origin_price",class:"form-label"},"原價",-1)),p(e("input",{type:"number",class:"form-control",id:"origin_price",min:"0","onUpdate:modelValue":t[6]||(t[6]=l=>s.value.origin_price=l),placeholder:"請輸入原價"},null,512),[[b,s.value.origin_price,void 0,{number:!0}]])]),e("div",ke,[t[19]||(t[19]=e("label",{for:"price",class:"form-label"},"售價",-1)),p(e("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":t[7]||(t[7]=l=>s.value.price=l),min:"0",placeholder:"請輸入售價"},null,512),[[b,s.value.price,void 0,{number:!0}]])])]),e("div",Ue,[t[20]||(t[20]=e("label",{for:"description",class:"form-label"},"產品描述",-1)),p(e("textarea",{class:"form-control",id:"description","onUpdate:modelValue":t[8]||(t[8]=l=>s.value.description=l),placeholder:"請輸入產品描述"},null,512),[[b,s.value.description]])]),e("div",Ce,[t[21]||(t[21]=e("label",{for:"content",class:"form-label"},"說明內容",-1)),p(e("textarea",{class:"form-control",id:"content","onUpdate:modelValue":t[9]||(t[9]=l=>s.value.content=l),placeholder:"請輸入產品說明內容"},null,512),[[b,s.value.content]])]),e("div",Me,[e("div",Pe,[p(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=l=>s.value.is_enabled=l),id:"is_enabled"},null,512),[[G,s.value.is_enabled]]),t[22]||(t[22]=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1))])])])])]),e("div",Ve,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[11]||(t[11]=l=>_("close"))},"取消"),e("button",{type:"button",class:"btn btn-primary",onClick:h},"儲存")])])])]}),_:1},8,["show"])]))}}),Ee={class:"pb-5"},Ne={class:"text-end mt-3"},Ie={class:"mt-4 overflow-auto"},Oe={class:"product-table",style:{"min-width":"700px"}},Se={class:"tbody pt-2"},Te={class:"td px-1 py-2",style:{flex:"1","min-width":"100px"}},je={class:"td px-1 py-2",style:{flex:"2","min-width":"200px"}},Ae={class:"td px-1 py-2",style:{flex:"1","min-width":"100px"}},Le={class:"td px-1 py-2",style:{flex:"1","min-width":"100px"}},De={key:0,class:"td px-1 py-2 text-success",style:{flex:"1","min-width":"100px"}},Fe={key:1,class:"td px-1 py-2 text-danger",style:{flex:"1","min-width":"100px"}},ze={style:{flex:"1","min-width":"100px"}},He=["onClick"],Qe=["onClick"],et=B({__name:"AdminProducts",setup(g){const m="https://vue3-course-api.hexschool.io/v2",c="jasper07301",_=y([]),s=y({}),u=y(!1),h=y(!1),n=y({title:"",category:"",origin_price:0,price:0,is_enabled:!1}),t=y(null);let v=null;const x=async(d=1)=>{try{u.value=!0;const o=`${m}/api/${c}/admin/products?page=${d}`,a=await P.get(o);if(a.data.success)_.value=a.data.products,s.value=a.data.pagination;else throw new Error(a.data.message||"獲取資料失敗")}catch(o){console.error("獲取資料失敗",o)}finally{u.value=!1}},l=(d,o)=>{!d&&o?n.value={...o}:n.value={title:"",category:"",origin_price:0,price:0,is_enabled:!1},h.value=!0},f=()=>{h.value=!1},k=async()=>{try{u.value=!0;const d=`${m}/api/${c}/admin/product/${n.value.id}`,o=await P.delete(d);if(o.data.success)x();else throw new Error(o.data.message||"刪除失敗")}catch(d){console.error("刪除產品失敗",d)}finally{u.value=!1}v==null||v.hide()},S=d=>{n.value={...d},t.value&&(v=new A(t.value.$el),v.show())},T=async d=>{try{u.value=!0;const o=n.value.id?`${m}/api/${c}/admin/product/${n.value.id}`:`${m}/api/${c}/admin/product`,a=n.value.id?"put":"post",C=await P[a](o,{data:d});if(C.data.success)x(),h.value=!1;else throw new Error(C.data.message||"儲存失敗")}catch(o){console.error("儲存產品失敗",o)}finally{u.value=!1}};return J(()=>{x()}),(d,o)=>(i(),r(V,null,[w(M(L),{active:u.value||u.value,"z-index":1060},null,8,["active"]),e("div",Ee,[e("div",Ne,[e("button",{type:"button",class:"btn btn-dark rounded",onClick:o[0]||(o[0]=()=>l(!0))}," 建立新的產品 ")]),e("div",Ie,[e("div",Oe,[o[1]||(o[1]=K('<div class="thead fw-bold pb-2 border-bottom border-3 border-dark"><div class="tr d-flex"><div class="th px-1 py-2" style="flex:1;min-width:100px;">分類</div><div class="th px-1 py-2" style="flex:2;min-width:200px;">產品名稱</div><div class="th px-1 py-2" style="flex:1;min-width:100px;">原價</div><div class="th px-1 py-2" style="flex:1;min-width:100px;">售價</div><div class="th px-1 py-2" style="flex:1;min-width:100px;">是否啟用</div><div class="th px-1 py-2" style="flex:1;min-width:100px;">編輯</div></div></div>',1)),e("div",Se,[(i(!0),r(V,null,O(_.value,a=>(i(),r("div",{class:"tr d-flex border-bottom",key:a.id},[e("div",Te,$(a.category),1),e("div",je,$(a.title),1),e("div",Ae,$(M(E)(a.origin_price)),1),e("div",Le,$(M(E)(a.price)),1),a.is_enabled?(i(),r("div",De," 啟用 ")):(i(),r("div",Fe," 未啟用 ")),e("div",ze,[e("button",{type:"button",class:"btn btn-outline-dark rounded btn-sm",onClick:C=>l(!1,a)}," 編輯 ",8,He),e("button",{type:"button",class:"btn btn-outline-dark rounded btn-sm ms-1",onClick:()=>S(a)}," 刪除 ",8,Qe)])]))),128))])])]),w(j,{onUpdatePage:x,pages:s.value},null,8,["pages"])]),w(W,{ref_key:"deleteModalElement",ref:t,onDeleteItem:k,title:n.value.title},null,8,["title"]),w(Be,{isModalOpen:h.value,tempProduct:n.value,onClose:f,onSave:T},null,8,["isModalOpen","tempProduct"])],64))}});export{et as default};
