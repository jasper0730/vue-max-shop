import{a as f}from"./index-DW_MHI2K.js";import{G as x,r as v,O as y}from"./index-Dw_dclxC.js";import{S as g}from"./sweetalert2.esm.all-B0Dix5B2.js";/*! js-cookie v3.0.5 | MIT */function p(r){for(var s=1;s<arguments.length;s++){var c=arguments[s];for(var u in c)r[u]=c[u]}return r}var C={read:function(r){return r[0]==='"'&&(r=r.slice(1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){return encodeURIComponent(r).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function h(r,s){function c(o,i,e){if(!(typeof document>"u")){e=p({},s,e),typeof e.expires=="number"&&(e.expires=new Date(Date.now()+e.expires*864e5)),e.expires&&(e.expires=e.expires.toUTCString()),o=encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var t="";for(var n in e)e[n]&&(t+="; "+n,e[n]!==!0&&(t+="="+e[n].split(";")[0]));return document.cookie=o+"="+r.write(i,o)+t}}function u(o){if(!(typeof document>"u"||arguments.length&&!o)){for(var i=document.cookie?document.cookie.split("; "):[],e={},t=0;t<i.length;t++){var n=i[t].split("="),d=n.slice(1).join("=");try{var a=decodeURIComponent(n[0]);if(e[a]=r.read(d,a),o===a)break}catch{}}return o?e[o]:e}}return Object.create({set:c,get:u,remove:function(o,i){c(o,"",p({},i,{expires:-1}))},withAttributes:function(o){return h(this.converter,p({},this.attributes,o))},withConverter:function(o){return h(p({},this.converter,o),this.attributes)}},{attributes:{value:Object.freeze(s)},converter:{value:Object.freeze(r)}})}var w=h(C,{path:"/"});const l="https://vue3-course-api.hexschool.io/v2",U=x("auth",()=>{const r=v(!1),s=y(),c=v(!1);return{logOut:async()=>{try{const e=`${l}/logout`,t=await f.post(e);w.remove("myToken"),t.data.success&&(g.fire({title:"",text:"已登出",icon:"success",timer:3e3}),c.value=!1,s.push("/"))}catch(e){console.error(e)}},logIn:async(e,t)=>{try{const n=`${l}/admin/signin`,d={username:e.email,password:e.password},a=await f.post(n,d),{token:m,expired:k}=a.data;if(a.data.success)w.set("myToken",m,{expires:new Date(k)}),s.push("/admin/products");else throw new Error(a.data.message||"登入失敗")}catch(n){t(),g.fire({title:"失敗",text:"登入",icon:"error",timer:3e3}),console.error("登入失敗",n)}},checkAuth:async()=>{try{r.value=!0;const e=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),t=`${l}/api/user/check`;if(!e)throw new Error("token is undefined");if(f.defaults.headers.common.Authorization=`${e}`,(await f.post(t)).data.success)c.value=!0;else throw new Error("faild auth")}catch(e){e&&s.push("/")}finally{r.value=!1}},isLoading:r,status:c}});export{U as u};
