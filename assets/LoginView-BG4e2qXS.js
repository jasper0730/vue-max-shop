import{e as I,f as B,J as D,K as j,S as F,c as L,b as s,h as y,p as l,q as V,w as C,v as _,H as k,I as U,t as R,i as P,s as T,o as q}from"./index-DlmyDI21.js";import{u as O,t as $,c as z,a as S}from"./vee-validate-yup-S53d_qpJ.js";import{L as M}from"./index-CjLnr5Cg.js";/*! js-cookie v3.0.5 | MIT */function g(r){for(var d=1;d<arguments.length;d++){var p=arguments[d];for(var c in p)r[c]=p[c]}return r}var H={read:function(r){return r[0]==='"'&&(r=r.slice(1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){return encodeURIComponent(r).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function b(r,d){function p(t,i,e){if(!(typeof document>"u")){e=g({},d,e),typeof e.expires=="number"&&(e.expires=new Date(Date.now()+e.expires*864e5)),e.expires&&(e.expires=e.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var n="";for(var a in e)e[a]&&(n+="; "+a,e[a]!==!0&&(n+="="+e[a].split(";")[0]));return document.cookie=t+"="+r.write(i,t)+n}}function c(t){if(!(typeof document>"u"||arguments.length&&!t)){for(var i=document.cookie?document.cookie.split("; "):[],e={},n=0;n<i.length;n++){var a=i[n].split("="),m=a.slice(1).join("=");try{var f=decodeURIComponent(a[0]);if(e[f]=r.read(m,f),t===f)break}catch{}}return t?e[t]:e}}return Object.create({set:p,get:c,remove:function(t,i){p(t,"",g({},i,{expires:-1}))},withAttributes:function(t){return b(this.converter,g({},this.attributes,t))},withConverter:function(t){return b(g({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(d)},converter:{value:Object.freeze(r)}})}var J=b(H,{path:"/"});const K={class:"bg-light",style:{height:"100vh"}},G={class:"container"},Q={class:"col-10 col-sm-6 col-md-4"},W={class:"mb-3"},X={class:"text-danger py-1"},Y={class:"mb-4"},Z={class:"text-danger py-1"},N={class:"mb-3 text-end"},se=I({__name:"LoginView",setup(r){const d="https://vue3-course-api.hexschool.io/v2",p=j(),c=B(!1),{handleSubmit:t,defineField:i,errors:e}=O({validationSchema:$(z({email:S().required("請輸入 Email").email("請輸入有效的 Email").default(""),password:S().required("請輸入密碼").default("")}))}),[n,a]=i("email"),[m,f]=i("password"),w=t(async(h,{resetForm:o})=>{try{c.value=!0;const v=`${d}/admin/signin`,u={username:h.email,password:h.password},x=await D.post(v,u),{token:A,expired:E}=x.data;if(x.data.success)J.set("myToken",A,{expires:new Date(E)}),p.push("/admin/products");else throw new Error(x.data.message||"登入失敗")}catch(v){o(),F.fire({title:"失敗",text:"登入",icon:"error",timer:3e3}),console.error("登入失敗",v)}finally{c.value=!1}});return(h,o)=>{const v=T("router-link");return q(),L("div",K,[s("div",G,[y(l(M),{active:c.value},null,8,["active"]),s("form",{class:"row justify-content-center pt-7",onSubmit:o[2]||(o[2]=V((...u)=>l(w)&&l(w)(...u),["prevent"]))},[s("div",Q,[o[7]||(o[7]=s("h1",{class:"h3 text-center"},"請先登入",-1)),s("div",W,[o[3]||(o[3]=s("label",{for:"email",class:"col-form-label"},"Email Address",-1)),C(s("input",k({type:"text",class:"form-control bg-light",id:"email",placeholder:"Email Address","onUpdate:modelValue":o[0]||(o[0]=u=>U(n)?n.value=u:null)},l(a)),null,16),[[_,l(n)]]),s("div",X,R(l(e).email),1)]),s("div",Y,[o[4]||(o[4]=s("label",{for:"password",class:"col-form-label"},"Password",-1)),C(s("input",k({type:"password",class:"form-control bg-light",id:"password",placeholder:"Password","onUpdate:modelValue":o[1]||(o[1]=u=>U(m)?m.value=u:null)},l(f)),null,16),[[_,l(m)]]),s("div",Z,R(l(e).password),1)]),s("div",N,[o[6]||(o[6]=s("button",{type:"submit",class:"btn btn-dark btn-lg rounded w-100 mb-2"}," 登入 ",-1)),y(v,{to:"/"},{default:P(()=>o[5]||(o[5]=[s("button",{type:"button",class:"btn btn-outline-dark btn-lg rounded w-100"}," 回首頁 ",-1)])),_:1})])])],32)])])}}});export{se as default};
